CREATE STREAM FHIR_JSON_STREAM (resourceType VARCHAR, 
							    gender VARCHAR, 
								birthDate VARCHAR,
								maritalStatus STRUCT<coding ARRAY<STRUCT<system VARCHAR, code VARCHAR>>>,                                 
								name ARRAY<STRUCT<family VARCHAR, given ARRAY<VARCHAR>>>,
								address ARRAY<STRUCT<city VARCHAR, state VARCHAR>>,
								generalPractitioner ARRAY<STRUCT<id VARCHAR>>,
								managingOrganization STRUCT<id VARCHAR>)								
								WITH (KAFKA_TOPIC='FhirTopic',VALUE_FORMAT='JSON');
CREATE STREAM FHIR_AVRO_STREAM WITH (VALUE_FORMAT='AVRO') AS SELECT * FROM FHIR_JSON_STREAM;
CREATE TABLE FHIR_GROUPBY_ORG WITH (VALUE_FORMAT='AVRO') AS SELECT MANAGINGORGANIZATION->ID AS ORG_ID, GENDER AS PATIENT_GENDER, count(*) AS CNT FROM FHIR_AVRO_STREAM GROUP BY MANAGINGORGANIZATION->ID,GENDER;
CREATE TABLE FHIR_GROUPBY_ORG_SINK WITH (VALUE_FORMAT='AVRO') AS SELECT TIMESTAMPTOSTRING(ROWTIME, 'yyyy-MM-dd HH:mm:ss.SSS') AS TS, ORG_ID, PATIENT_GENDER, CNT FROM FHIR_GROUPBY_ORG;